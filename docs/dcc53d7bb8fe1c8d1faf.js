/*! For license information please see dcc53d7bb8fe1c8d1faf.js.LICENSE.txt */
function _regenerator(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function s(r,t,a,s){var c=t&&t.prototype instanceof i?t:i,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,t,a){var s,i,c,u=0,l=a||[],f=!1,g={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,r){return s=n,i=0,c=e,g.n=r,o}};function m(r,t){for(i=r,c=t,n=0;!f&&u&&!a&&n<l.length;n++){var a,s=l[n],m=g.p,d=s[2];r>3?(a=d===t)&&(c=s[(i=s[4])?5:(i=3,3)],s[4]=s[5]=e):s[0]<=m&&((a=r<2&&m<s[1])?(i=0,g.v=t,g.n=s[1]):m<d&&(a=r<3||s[0]>t||t>d)&&(s[4]=r,s[5]=t,g.n=d,i=0))}if(a||r>1)return o;throw f=!0,t}return function(a,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&m(l,d),i=l,c=d;(n=i<2?e:c)||!f;){s||(i?i<3?(i>1&&(g.n=-1),m(i,c)):g.n=c:g.v=c);try{if(u=2,s){if(i||(a="next"),n=s[a]){if(!(n=n.call(s,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=s.return)&&n.call(s),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);s=e}else if((n=(f=g.n<0)?c:r.call(t,g))!==o)break}catch(n){s=e,i=1,c=n}finally{u=1}}return{value:n,done:f}}}(r,a,s),!0),u}var o={};function i(){}function c(){}function u(){}n=Object.getPrototypeOf;var l=[][t]?n(n([][t]())):(_regeneratorDefine2(n={},t,function(){return this}),n),f=u.prototype=i.prototype=Object.create(l);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,_regeneratorDefine2(f,"constructor",u),_regeneratorDefine2(u,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(u,a,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,a,"Generator"),_regeneratorDefine2(f,t,function(){return this}),_regeneratorDefine2(f,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:s,m:g}})()}function _regeneratorDefine2(e,n,r,t){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,n,r,t){function s(n,r){_regeneratorDefine2(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(s("next",0),s("throw",1),s("return",2))},_regeneratorDefine2(e,n,r,t)}function asyncGeneratorStep(e,n,r,t,a,s,o){try{var i=e[s](o),c=i.value}catch(e){return void r(e)}i.done?n(c):Promise.resolve(c).then(t,a)}function _asyncToGenerator(e){return function(){var n=this,r=arguments;return new Promise(function(t,a){var s=e.apply(n,r);function o(e){asyncGeneratorStep(s,t,a,o,i,"next",e)}function i(e){asyncGeneratorStep(s,t,a,o,i,"throw",e)}o(void 0)})}}Office.initialize=function(){console.log("Office.js est initialisé")},Office.onReady(function(e){if(e.host===Office.HostType.Word){var n=function(e,n,r){var t=document.getElementById(e);if(t){var a=document.createElement("div");a.innerHTML=n,t.prepend(a);var s=document.getElementById("console");s&&(s.textContent=n+"\n"+s.textContent)}else console.error('Élément avec ID "'.concat(e,'" non trouvé'))},r=function(){var e=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,Word.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=n.document.body,t=r.getOoxml(),e.n=1,n.sync();case 1:return e.a(2,t.value)}},e)}));return function(n){return e.apply(this,arguments)}}()))},e)}));return function(){return e.apply(this,arguments)}}(),t=function(e){for(var n=e.getElementsByTagName("w:t"),r="",t=0;t<n.length;t++)r+=n[t].textContent;return r.trim()},a=function(){var e=_asyncToGenerator(_regenerator().m(function e(){var n,a,s,o,i,c,u,l,f,g,m,d,p,v,h,b,y,k,_,w,E,T,x,O,I,L,D,G,C,N,B,P;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=function(e,n){for(var r=e;r&&r.nodeName&&"w:p"!==r.nodeName.toLowerCase();)r=r.parentNode;if(!r)return-1;for(var t=0;t<n.length;t++)if(n[t]===r)return t;return-1},e.n=1,r();case 1:if(a=e.v,s=new DOMParser,o=s.parseFromString(a,"application/xml"),!((i=o.getElementsByTagName("parsererror")).length>0)){e.n=2;break}throw new Error("Erreur lors de l'analyse OOXML: "+i[0].textContent);case 2:for(c=o.getElementsByTagName("w:drawing")||[],u=o.getElementsByTagName("w:pict")||[],l=(c.length||0)+(u.length||0),f=o.getElementsByTagName("w:p"),g=/^Figure\s+\d+\s*[:\-–]?/i,m=[],d=0;d<f.length;d++)p=f[d],v=t(p),g.test(v)&&(h=!1,(b=p.getElementsByTagName("w:pPr"))&&b.length>0&&(y=b[0].getElementsByTagName("w:jc"))&&y.length>0&&y[0].getAttribute("w:val")&&"center"===y[0].getAttribute("w:val").toLowerCase()&&(h=!0),m.push({text:v,centered:h,nodeIndex:d}));k=-1,_=[],w=Array.from(o.getElementsByTagName("w:instrText")||[]),E=0;case 3:if(!(E<w.length&&-1===k)){e.n=5;break}if(T=(w[E].textContent||"").trim(),!/TOC\b|tableof|table of figures|table des illustrations|liste des figures|table des figures/i.test(T)){e.n=4;break}return k=n(w[E],f),e.a(3,5);case 4:E++,e.n=3;break;case 5:if(-1!==k){e.n=8;break}x=Array.from(o.getElementsByTagName("w:fldSimple")||[]),O=0;case 6:if(!(O<x.length)){e.n=8;break}if(I=x[O].getAttribute&&(x[O].getAttribute("w:instr")||x[O].getAttribute("instr"))||"",!/TOC\b|tableof|table of figures|table des illustrations|liste des figures|table des figures/i.test(I)){e.n=7;break}return k=n(x[O],f),e.a(3,8);case 7:O++,e.n=6;break;case 8:if(-1!==k){e.n=12;break}L=0;case 9:if(!(L<f.length)){e.n=12;break}if(D=t(f[L])){e.n=10;break}return e.a(3,11);case 10:if(!/\bFigure\s*\d+\b/i.test(D)||!/\.{3,}/.test(D)&&!/\s\d+$/.test(D)&&-1===D.indexOf("\t")){e.n=11;break}return k=L,e.a(3,12);case 11:L++,e.n=9;break;case 12:if(-1===k){e.n=18;break}G=k+1;case 13:if(!(G<f.length)){e.n=18;break}if(C=t(f[G])){e.n=14;break}return e.a(3,18);case 14:if(!(g.test(C)||C.toLowerCase().includes("figure")&&(/\s\d+$/.test(C)||/\.{3,}/.test(C)||-1!==C.indexOf("\t")))){e.n=15;break}N=f[G].getElementsByTagName("w:hyperlink"),B=N&&N.length>0,_.push({text:C,hasLink:B}),e.n=16;break;case 15:if(!(C.length<2)){e.n=16;break}return e.a(3,18);case 16:if(!(_.length>200)){e.n=17;break}return e.a(3,18);case 17:G++,e.n=13;break;case 18:return e.a(2,{imageCount:l,captions:m,listNodeIndex:k,listEntries:_});case 19:throw e.p=19,P=e.v,console.error("Erreur dans analyzeDocument:",P),P;case 20:return e.a(2)}},e,null,[[0,19]])}));return function(){return e.apply(this,arguments)}}();console.log("Word est prêt ! Votre complément peut s'initialiser"),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("chk-images");e&&(e.onclick=_asyncToGenerator(_regenerator().m(function e(){var r,t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a();case 1:(r=e.v).imageCount<2?0===r.imageCount?(n("res-images",'<span class="ko">Aucune image détectée dans le document.</span>'),n("console","Vérification images: 0 trouvées.")):(n("res-images",'<span class="ko">Pas plusieurs images détectées (seulement 1 image).</span>'),n("console","Vérification images: 1 trouvée — pas de pluralité.")):2===r.imageCount?(n("res-images",'<span class="ok">Images détectées: 2 — OK.</span>'),n("console","Vérification images: 2 trouvées — OK.")):(n("res-images","Images détectées: "+r.imageCount),n("console","Vérification images: "+r.imageCount+" trouvées.")),e.n=3;break;case 2:e.p=2,t=e.v,n("res-images","Erreur: "+t.message),console.error(t);case 3:return e.a(2)}},e,null,[[0,2]])})));var r=document.getElementById("chk-captions");r&&(r.onclick=_asyncToGenerator(_regenerator().m(function e(){var r,t,s;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a();case 1:r=e.v,0===(t=r.captions.length)?n("res-captions",'Aucune légende détectée (pattern "Figure N : ...").'):(n("res-captions","Légendes détectées: "+t),r.captions.forEach(function(e,r){var t=e.centered?'<span class="ok">centrée</span>':'<span class="ko">non centrée</span>';n("res-captions","• "+e.text+" — "+t)})),n("console","Vérification légendes terminée."),e.n=3;break;case 2:e.p=2,s=e.v,n("res-captions","Erreur: "+s.message),console.error(s);case 3:return e.a(2)}},e,null,[[0,2]])})));var t=document.getElementById("chk-list");t&&(t.onclick=_asyncToGenerator(_regenerator().m(function e(){var r,t,s;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a();case 1:if(-1!==(r=e.v).listNodeIndex){e.n=2;break}return n("res-list",'<span class="ko">Aucune "Liste des figures" détectée.</span>'),n("console","Vérification liste des figures: introuvable."),e.a(2);case 2:if(r.listEntries&&0!==r.listEntries.length){e.n=3;break}return n("res-list",'<span class="ko">Table des figures trouvée mais aucune entrée détectée.</span>'),n("console","Vérification liste des figures: table trouvée mais 0 entrées."),e.a(2);case 3:(t=r.listEntries.length===r.captions.length)?(n("res-list",'<span class="ok">Liste des figures trouvée et nombre d\'entrées cohérent avec les légendes ('+r.captions.length+").</span>"),n("console","Vérification liste des figures: OK ("+r.listEntries.length+" entrées).")):(n("res-list",'<span class="ko">Liste trouvée mais nombre d\'entrées ('+r.listEntries.length+") != nombre de légendes ('"+r.captions.length+"').</span>"),n("console","Vérification liste des figures: KO (comptes différents).")),r.listEntries.forEach(function(e,r){var a=t||e.hasLink?"ok":"ko";n("res-list",'• <span class="'+a+'">'+e.text+"</span>"+(e.hasLink?" (lien)":" (pas de lien)"))}),e.n=5;break;case 4:e.p=4,s=e.v,n("res-list","Erreur: "+s.message),console.error(s);case 5:return e.a(2)}},e,null,[[0,4]])})));var s=document.getElementById("chk-links");s&&(s.onclick=_asyncToGenerator(_regenerator().m(function e(){var r,t,s;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a();case 1:if(-1!==(r=e.v).listNodeIndex){e.n=2;break}return n("res-links","Impossible de vérifier les liens car la liste des figures est introuvable."),e.a(2);case 2:0===(t=r.listEntries.filter(function(e){return!e.hasLink})).length?n("res-links","Tous les éléments de la liste des figures semblent avoir des liens."):n("res-links",t.length+" éléments dans la liste des figures n'ont pas de lien."),e.n=4;break;case 3:e.p=3,s=e.v,n("res-links","Erreur: "+s.message),console.error(s);case 4:return e.a(2)}},e,null,[[0,3]])})));var o=document.getElementById("btn-init");o&&(o.onclick=_asyncToGenerator(_regenerator().m(function e(){var r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Word.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(r){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(t=r.document.body).load("text"),e.n=1,r.sync();case 1:if(!(t.text&&t.text.trim().length>0)){e.n=3;break}if(confirm("Le document contient déjà du texte. Effacer pour créer le document d'exemple ?")){e.n=2;break}return e.a(2);case 2:t.clear();case 3:return t.insertParagraph("Exercice : Insérer plusieurs images à différents emplacements, ajouter une légende sous chaque image (centrée, numérotée automatiquement), et générer une liste des figures.",Word.InsertLocation.end),t.insertParagraph("\n--- Page 1 ---\n",Word.InsertLocation.end),t.insertParagraph("Instructions répétées pour remplir le document...",Word.InsertLocation.end),t.insertParagraph("\n--- Page 2 ---\n",Word.InsertLocation.end),t.insertParagraph('Placez des images manuellement à différents emplacements, puis ajoutez une légende sous chaque image de la forme "Figure 1 : ..."',Word.InsertLocation.end),e.n=4,r.sync();case 4:n("console","Document d'exemple créé (partiel). Ajoutez des images manuelles puis utilisez les vérifications.");case 5:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,r=e.v,n("console","Erreur initialisation: "+r.message),console.error(r);case 3:return e.a(2)}},e,null,[[0,2]])}))),n("console","Complément prêt à l'emploi !")})}});