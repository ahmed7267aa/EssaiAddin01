/*! For license information please see insertimagelegend.js.LICENSE.txt */
!function(){function e(){var t,r,s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",i=s.toStringTag||"@@toStringTag";function o(e,s,a,i){var o=s&&s.prototype instanceof u?s:u,l=Object.create(o.prototype);return n(l,"_invoke",function(e,n,s){var a,i,o,u=0,l=s||[],f=!1,g={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,i=0,o=t,g.n=n,c}};function m(e,n){for(i=e,o=n,r=0;!f&&u&&!s&&r<l.length;r++){var s,a=l[r],m=g.p,d=a[2];e>3?(s=d===n)&&(o=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=m&&((s=e<2&&m<a[1])?(i=0,g.v=n,g.n=a[1]):m<d&&(s=e<3||a[0]>n||n>d)&&(a[4]=e,a[5]=n,g.n=d,i=0))}if(s||e>1)return c;throw f=!0,n}return function(s,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&m(l,d),i=l,o=d;(r=i<2?t:o)||!f;){a||(i?i<3?(i>1&&(g.n=-1),m(i,o)):g.n=o:g.v=o);try{if(u=2,a){if(i||(s="next"),r=a[s]){if(!(r=r.call(a,o)))throw TypeError("iterator result is not an object");if(!r.done)return r;o=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(o=TypeError("The iterator does not provide a '"+s+"' method"),i=1);a=t}else if((r=(f=g.n<0)?o:e.call(n,g))!==c)break}catch(e){a=t,i=1,o=e}finally{u=1}}return{value:r,done:f}}}(e,a,i),!0),l}var c={};function u(){}function l(){}function f(){}r=Object.getPrototypeOf;var g=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=f.prototype=u.prototype=Object.create(g);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=f,n(m,"constructor",f),n(f,"constructor",l),l.displayName="GeneratorFunction",n(f,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:o,m:d}})()}function n(e,t,r,s){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,s){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!s,configurable:!s,writable:!s}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,s)}function t(e,n,t,r,s,a,i){try{var o=e[a](i),c=o.value}catch(e){return void t(e)}o.done?n(c):Promise.resolve(c).then(r,s)}function r(e){return function(){var n=this,r=arguments;return new Promise(function(s,a){var i=e.apply(n,r);function o(e){t(i,s,a,o,c,"next",e)}function c(e){t(i,s,a,o,c,"throw",e)}o(void 0)})}}Office.initialize=function(){console.log("Office.js est initialisé")},Office.onReady(function(n){if(n.host===Office.HostType.Word){var t=function(e,n,t){var r=document.getElementById(e);if(r){var s=document.createElement("div");s.innerHTML=n,r.prepend(s);var a=document.getElementById("console");a&&(a.textContent=n+"\n"+a.textContent)}else console.error('Élément avec ID "'.concat(e,'" non trouvé'))},s=function(){var n=r(e().m(function n(){return e().w(function(n){for(;;)if(0===n.n)return n.a(2,Word.run(function(){var n=r(e().m(function n(t){var r,s;return e().w(function(e){for(;;)switch(e.n){case 0:return r=t.document.body,s=r.getOoxml(),e.n=1,t.sync();case 1:return e.a(2,s.value)}},n)}));return function(e){return n.apply(this,arguments)}}()))},n)}));return function(){return n.apply(this,arguments)}}(),a=function(e){for(var n=e.getElementsByTagName("w:t"),t="",r=0;r<n.length;r++)t+=n[r].textContent;return t.trim()},i=function(){var n=r(e().m(function n(){var t,r,i,o,c,u,l,f,g,m,d,p,v,h,b,k,y,w,E,x,O,T,I,L,C,N,B,P,j,A,V,W;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=function(e,n){for(var t=e;t&&t.nodeName&&"w:p"!==t.nodeName.toLowerCase();)t=t.parentNode;if(!t)return-1;for(var r=0;r<n.length;r++)if(n[r]===t)return r;return-1},e.n=1,s();case 1:if(r=e.v,i=new DOMParser,o=i.parseFromString(r,"application/xml"),!((c=o.getElementsByTagName("parsererror")).length>0)){e.n=2;break}throw new Error("Erreur lors de l'analyse OOXML: "+c[0].textContent);case 2:for(u=o.getElementsByTagName("w:drawing")||[],l=o.getElementsByTagName("w:pict")||[],f=(u.length||0)+(l.length||0),g=o.getElementsByTagName("w:p"),m=/^Figure\s+\d+\s*[:\-–]?/i,d=[],p=0;p<g.length;p++)v=g[p],h=a(v),m.test(h)&&(b=!1,(k=v.getElementsByTagName("w:pPr"))&&k.length>0&&(y=k[0].getElementsByTagName("w:jc"))&&y.length>0&&y[0].getAttribute("w:val")&&"center"===y[0].getAttribute("w:val").toLowerCase()&&(b=!0),d.push({text:h,centered:b,nodeIndex:p}));w=-1,E=[],x=Array.from(o.getElementsByTagName("w:instrText")||[]),O=0;case 3:if(!(O<x.length&&-1===w)){e.n=5;break}if(T=(x[O].textContent||"").trim(),!/TOC\b|tableof|table of figures|table des illustrations|liste des figures|table des figures/i.test(T)){e.n=4;break}return w=t(x[O],g),e.a(3,5);case 4:O++,e.n=3;break;case 5:if(-1!==w){e.n=8;break}I=Array.from(o.getElementsByTagName("w:fldSimple")||[]),L=0;case 6:if(!(L<I.length)){e.n=8;break}if(C=I[L].getAttribute&&(I[L].getAttribute("w:instr")||I[L].getAttribute("instr"))||"",!/TOC\b|tableof|table of figures|table des illustrations|liste des figures|table des figures/i.test(C)){e.n=7;break}return w=t(I[L],g),e.a(3,8);case 7:L++,e.n=6;break;case 8:if(-1!==w){e.n=12;break}N=0;case 9:if(!(N<g.length)){e.n=12;break}if(B=a(g[N])){e.n=10;break}return e.a(3,11);case 10:if(!/\bFigure\s*\d+\b/i.test(B)||!/\.{3,}/.test(B)&&!/\s\d+$/.test(B)&&-1===B.indexOf("\t")){e.n=11;break}return w=N,e.a(3,12);case 11:N++,e.n=9;break;case 12:if(-1===w){e.n=18;break}P=w+1;case 13:if(!(P<g.length)){e.n=18;break}if(j=a(g[P])){e.n=14;break}return e.a(3,18);case 14:if(!(m.test(j)||j.toLowerCase().includes("figure")&&(/\s\d+$/.test(j)||/\.{3,}/.test(j)||-1!==j.indexOf("\t")))){e.n=15;break}A=g[P].getElementsByTagName("w:hyperlink"),V=A&&A.length>0,E.push({text:j,hasLink:V}),e.n=16;break;case 15:if(!(j.length<2)){e.n=16;break}return e.a(3,18);case 16:if(!(E.length>200)){e.n=17;break}return e.a(3,18);case 17:P++,e.n=13;break;case 18:return e.a(2,{imageCount:f,captions:d,listNodeIndex:w,listEntries:E});case 19:throw e.p=19,W=e.v,console.error("Erreur dans analyzeDocument:",W),W;case 20:return e.a(2)}},n,null,[[0,19]])}));return function(){return n.apply(this,arguments)}}();console.log("Word est prêt ! Votre complément peut s'initialiser"),document.addEventListener("DOMContentLoaded",function(){var n=document.getElementById("chk-images");n&&(n.onclick=r(e().m(function n(){var r,s;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,i();case 1:(r=e.v).imageCount<2?0===r.imageCount?(t("res-images",'<span class="ko">Aucune image détectée dans le document.</span>'),t("console","Vérification images: 0 trouvées.")):(t("res-images",'<span class="ko">Pas plusieurs images détectées (seulement 1 image).</span>'),t("console","Vérification images: 1 trouvée — pas de pluralité.")):2===r.imageCount?(t("res-images",'<span class="ok">Images détectées: 2 — OK.</span>'),t("console","Vérification images: 2 trouvées — OK.")):(t("res-images","Images détectées: "+r.imageCount),t("console","Vérification images: "+r.imageCount+" trouvées.")),e.n=3;break;case 2:e.p=2,s=e.v,t("res-images","Erreur: "+s.message),console.error(s);case 3:return e.a(2)}},n,null,[[0,2]])})));var s=document.getElementById("chk-captions");s&&(s.onclick=r(e().m(function n(){var r,s,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,i();case 1:r=e.v,0===(s=r.captions.length)?t("res-captions",'Aucune légende détectée (pattern "Figure N : ...").'):(t("res-captions","Légendes détectées: "+s),r.captions.forEach(function(e,n){var r=e.centered?'<span class="ok">centrée</span>':'<span class="ko">non centrée</span>';t("res-captions","• "+e.text+" — "+r)})),t("console","Vérification légendes terminée."),e.n=3;break;case 2:e.p=2,a=e.v,t("res-captions","Erreur: "+a.message),console.error(a);case 3:return e.a(2)}},n,null,[[0,2]])})));var a=document.getElementById("chk-list");a&&(a.onclick=r(e().m(function n(){var r,s,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,i();case 1:if(-1!==(r=e.v).listNodeIndex){e.n=2;break}return t("res-list",'<span class="ko">Aucune "Liste des figures" détectée.</span>'),t("console","Vérification liste des figures: introuvable."),e.a(2);case 2:if(r.listEntries&&0!==r.listEntries.length){e.n=3;break}return t("res-list",'<span class="ko">Table des figures trouvée mais aucune entrée détectée.</span>'),t("console","Vérification liste des figures: table trouvée mais 0 entrées."),e.a(2);case 3:(s=r.listEntries.length===r.captions.length)?(t("res-list",'<span class="ok">Liste des figures trouvée et nombre d\'entrées cohérent avec les légendes ('+r.captions.length+").</span>"),t("console","Vérification liste des figures: OK ("+r.listEntries.length+" entrées).")):(t("res-list",'<span class="ko">Liste trouvée mais nombre d\'entrées ('+r.listEntries.length+") != nombre de légendes ('"+r.captions.length+"').</span>"),t("console","Vérification liste des figures: KO (comptes différents).")),r.listEntries.forEach(function(e,n){var r=s||e.hasLink?"ok":"ko";t("res-list",'• <span class="'+r+'">'+e.text+"</span>"+(e.hasLink?" (lien)":" (pas de lien)"))}),e.n=5;break;case 4:e.p=4,a=e.v,t("res-list","Erreur: "+a.message),console.error(a);case 5:return e.a(2)}},n,null,[[0,4]])})));var o=document.getElementById("chk-links");o&&(o.onclick=r(e().m(function n(){var r,s,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,i();case 1:if(-1!==(r=e.v).listNodeIndex){e.n=2;break}return t("res-links","Impossible de vérifier les liens car la liste des figures est introuvable."),e.a(2);case 2:0===(s=r.listEntries.filter(function(e){return!e.hasLink})).length?t("res-links","Tous les éléments de la liste des figures semblent avoir des liens."):t("res-links",s.length+" éléments dans la liste des figures n'ont pas de lien."),e.n=4;break;case 3:e.p=3,a=e.v,t("res-links","Erreur: "+a.message),console.error(a);case 4:return e.a(2)}},n,null,[[0,3]])})));var c=document.getElementById("btn-init");c&&(c.onclick=r(e().m(function n(){var s;return e().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,Word.run(function(){var n=r(e().m(function n(r){var s;return e().w(function(e){for(;;)switch(e.n){case 0:return(s=r.document.body).load("text"),e.n=1,r.sync();case 1:if(!(s.text&&s.text.trim().length>0)){e.n=3;break}if(confirm("Le document contient déjà du texte. Effacer pour créer le document d'exemple ?")){e.n=2;break}return e.a(2);case 2:s.clear();case 3:return s.insertParagraph("Exercice : Insérer plusieurs images à différents emplacements, ajouter une légende sous chaque image (centrée, numérotée automatiquement), et générer une liste des figures.",Word.InsertLocation.end),s.insertParagraph("\n--- Page 1 ---\n",Word.InsertLocation.end),s.insertParagraph("Instructions répétées pour remplir le document...",Word.InsertLocation.end),s.insertParagraph("\n--- Page 2 ---\n",Word.InsertLocation.end),s.insertParagraph('Placez des images manuellement à différents emplacements, puis ajoutez une légende sous chaque image de la forme "Figure 1 : ..."',Word.InsertLocation.end),e.n=4,r.sync();case 4:t("console","Document d'exemple créé (partiel). Ajoutez des images manuelles puis utilisez les vérifications.");case 5:return e.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());case 1:n.n=3;break;case 2:n.p=2,s=n.v,t("console","Erreur initialisation: "+s.message),console.error(s);case 3:return n.a(2)}},n,null,[[0,2]])}))),t("console","Complément prêt à l'emploi !")})}})}();
//# sourceMappingURL=insertimagelegend.js.map